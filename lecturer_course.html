{% extends "base.html" %}
{% block title %} · {{ course["code"] }}{% endblock %}

{% block content %}
  <section class="card">
    <div class="row between">
      <div>
        <h1>{{ course["code"] }} — {{ course["name"] }}</h1>
        <p class="muted">Manage student comments/questions.</p>
      </div>
      <a class="btn secondary" href="{{ url_for('lecturer_dashboard') }}">Back</a>
    </div>

    <div class="divider"></div>

    <div class="row gap">
      <a class="pilllink {% if status=='open' %}active{% endif %}" href="{{ url_for('lecturer_course', course_id=course['id'], status='open') }}">Open</a>
      <a class="pilllink {% if status=='resolved' %}active{% endif %}" href="{{ url_for('lecturer_course', course_id=course['id'], status='resolved') }}">Resolved</a>
      <a class="pilllink {% if status=='all' %}active{% endif %}" href="{{ url_for('lecturer_course', course_id=course['id'], status='all') }}">All</a>
    </div>

    <div class="divider"></div>

    {% if comments %}
      <div class="table">
        <div class="trow thead">
          <div>ID</div>
          <div>Time</div>
          <div>Student</div>
          <div>Content</div>
          <div>Status</div>
          <div>Action</div>
        </div>

        {% for c in comments %}
          <div class="trow">
            <div>#{{ c["id"] }}</div>
            <div class="small">{{ c["created_at"] }}</div>
            <div>
              {% if c["anonymous"] == 1 %}
                Anonymous
              {% else %}
                {{ c["display_name"] if c["display_name"] else "Student" }}
              {% endif %}
            </div>
            <div>{{ c["content"] }}</div>
            <div>
              <span class="badge {% if c['status']=='open' %}badge-open{% else %}badge-resolved{% endif %}">
                {{ c["status"] }}
              </span>
              {% if c["lecturer_note"] %}
                <div class="muted small">Note: {{ c["lecturer_note"] }}</div>
              {% endif %}
            </div>
            <div>
              {% if c["status"] == "open" %}
                <form method="post" action="{{ url_for('lecturer_resolve_comment', comment_id=c['id'], status=status) }}" class="form compact">
                  <input type="hidden" name="course_id" value="{{ course['id'] }}">
                  <input name="lecturer_note" placeholder="Optional note">
                  <button class="btn" type="submit">Resolve</button>
                </form>
              {% else %}
                <form method="post" action="{{ url_for('lecturer_reopen_comment', comment_id=c['id'], status=status) }}" class="inline">
                  <input type="hidden" name="course_id" value="{{ course['id'] }}">
                  <button class="btn secondary" type="submit">Re-open</button>
                </form>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No comments found for this filter.</p>
    {% endif %}
  </section>
{% endblock %}
